# Use a base image with necessary dependencies
FROM ubuntu:latest

# Install required packages
RUN apt-get update && apt-get install -y \
    build-essential \
    wget \
    libssl-dev \
    zlib1g-dev

# Download OpenSSH source
RUN wget https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-7.7p1.tar.gz

# Extract OpenSSH source
RUN tar -xzf openssh-7.7p1.tar.gz

# Change directory to OpenSSH source
WORKDIR /openssh-7.7p1

# Configure and build OpenSSH
RUN ./configure && \
    make && \
    make install

# Cleanup
RUN rm -rf /openssh-7.7p1* && \
    apt-get purge -y build-essential wget && \
    apt-get autoremove -y && \
    apt-get clean

# Expose SSH port
EXPOSE 22

# Start SSH service
CMD ["/usr/local/sbin/sshd", "-D"]