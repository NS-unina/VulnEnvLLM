# Use a base image with necessary tools for building
FROM ubuntu:latest

# Install dependencies
RUN apt-get update \
    && apt-get install -y \
       wget \
       build-essential \
       apache2 \
       libssl-dev \
       zlib1g-dev

# Set the working directory
WORKDIR /usr/src

# Download OpenSSL 1.0.1f source code
RUN wget https://www.openssl.org/source/old/1.0.1/openssl-1.0.1f.tar.gz \
    && tar -xzf openssl-1.0.1f.tar.gz

# Build and install OpenSSL 1.0.1f
WORKDIR /usr/src/openssl-1.0.1f
RUN ./config --prefix=/usr/local/ssl --openssldir=/usr/local/ssl \
    && make \
    && make install

# Download Apache HTTP Server source code
WORKDIR /usr/src
RUN wget https://archive.apache.org/dist/httpd/httpd-2.4.51.tar.gz \
    && tar -xzf httpd-2.4.51.tar.gz

# Build and install Apache HTTP Server with OpenSSL 1.0.1f
WORKDIR /usr/src/httpd-2.4.51
RUN ./configure --with-ssl=/usr/local/ssl --prefix=/usr/local/apache2 \
    && make \
    && make install

# Copy Apache configuration files
COPY ./httpd.conf /usr/local/apache2/conf/httpd.conf

# Expose port 80
EXPOSE 80

# Start Apache HTTP Server
CMD ["/usr/local/apache2/bin/httpd", "-D", "FOREGROUND"]
