# Use the official Drupal image as the base
FROM drupal:8.5.0

# Install required PHP extensions
RUN apt-get update && apt-get install -y \
        libpng-dev \
        libjpeg-dev \
        libpq-dev \
        libxml2-dev \
    && docker-php-ext-configure gd --with-jpeg-dir=/usr/include/ \
    && docker-php-ext-install -j$(nproc) \
        gd \
        opcache \
        pdo_mysql \
        pdo_pgsql \
        mysqli \
        xml \
        mbstring \
        zip

# Install MariaDB server
RUN apt-get update && apt-get install -y mariadb-server

# Copy custom configuration files if needed
# COPY php.ini /usr/local/etc/php/
# COPY apache.conf /etc/apache2/sites-available/000-default.conf

# Expose ports
EXPOSE 80
EXPOSE 3306

# Set up entry point to start both Drupal and MariaDB
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh
ENTRYPOINT ["/entrypoint.sh"]