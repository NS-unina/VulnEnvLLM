FROM nginx:latest

# Install system dependencies
RUN apt-get update && apt-get install -y \
    php7.4-fpm \
    php7.4-mysql \
    php7.4-mbstring \
    php-curl

# Create a working directory
WORKDIR /var/www/bludit

# Download Bludit and extract it
RUN wget https://github.com/bludit/bludit/releases/download/v3.9.2/bludit-3.9.2.zip && \
    unzip bludit-3.9.2.zip && \
    rm bludit-3.9.2.zip

# Copy Bludit configuration file
COPY ./bludit.conf /etc/nginx/sites-available/default

# Enable Bludit configuration
RUN ln -s /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default

# Remove default nginx configuration
RUN rm /etc/nginx/sites-enabled/default.conf

# Change ownership of Bludit directory
RUN chown -R www-data:www-data /var/www/bludit

# Expose Bludit port
EXPOSE 80

# Start Nginx and PHP-FPM
CMD ["nginx", "-g", "daemon off;"]