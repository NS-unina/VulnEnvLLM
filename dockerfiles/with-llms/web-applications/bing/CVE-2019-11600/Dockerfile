# Use an official Ruby runtime as a parent image
FROM ruby:2.5

# Set the working directory in the container to /app
WORKDIR /app

# Add metadata identifying these images as our build containers
LABEL openproject.build="packager"

# Install the necessary software
RUN apt-get update && apt-get install -y \
  build-essential \
  libmysqlclient-dev \
  mysql-client \
  libpq-dev \
  postgresql-client \
  sqlite3 \
  zlib1g-dev \
  libqt4-dev \
  libxml2-dev \
  libxslt1-dev \
  imagemagick \
  openjdk-8-jre \
  git

# Clone the specific version of OpenProject
RUN git clone --branch "v8.3.1" --depth 1 https://github.com/opf/openproject.git .

# Install the project dependencies
RUN bundle install

# Copy the rest of your app's source code from your host to your image filesystem.
COPY . .

# Expose port 3000 in the container
EXPOSE 3000

# Start the application server
CMD ["rails", "server", "-b", "0.0.0.0"]