# Use a base image with Java and Ant pre-installed
FROM openjdk:8-jdk-alpine AS builder

# Define environment variables
ENV OFBIZ_HOME /ofbiz

# Set up working directory
WORKDIR $OFBIZ_HOME

# Install necessary tools
RUN apk update && \
    apk add --no-cache curl && \
    apk add --no-cache unzip && \
    apk add --no-cache bash

# Download and extract OFBiz
RUN curl -fSL "https://archive.apache.org/dist/ofbiz/apache-ofbiz-10.04.04.zip" -o ofbiz.zip && \
    unzip ofbiz.zip && \
    rm ofbiz.zip && \
    mv apache-ofbiz-10.04.04/* . && \
    rm -rf apache-ofbiz-10.04.04

# Expose ports
EXPOSE 8080

# Start OFBiz
CMD ["./ant", "load-demo"]