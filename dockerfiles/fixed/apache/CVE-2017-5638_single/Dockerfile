# Use the official Tomcat 9 image as the base image
FROM tomcat:9

# Set environment variables
ENV STRUTS_VERSION=2.5.26
ENV STRUTS_EXAMPLE_VERSION=2.5.26

# Download Apache Struts and Example application
RUN wget https://downloads.apache.org/struts/${STRUTS_VERSION}/struts-2.5.26-all.zip && \
    unzip struts-2.5.26-all.zip && \
    mv struts-2.5.26-all/lib/* /usr/local/tomcat/lib/ && \
    rm -rf struts-2.5.26-all struts-2.5.26-all.zip

# Deploy the example application
RUN wget https://downloads.apache.org/struts/${STRUTS_EXAMPLE_VERSION}/struts2-examples-${STRUTS_EXAMPLE_VERSION}.war -P /usr/local/tomcat/webapps/ && \
    unzip /usr/local/tomcat/webapps/struts2-examples-${STRUTS_EXAMPLE_VERSION}.war -d /usr/local/tomcat/webapps/struts2-examples && \
    rm -rf /usr/local/tomcat/webapps/struts2-examples-${STRUTS_EXAMPLE_VERSION}.war

# Expose port 8080
EXPOSE 8080

# Start Tomcat
CMD ["catalina.sh", "run"]
