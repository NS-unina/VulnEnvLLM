# Use the official WordPress image as base
FROM wordpress:latest

# Set environment variables for WordPress
ENV WORDPRESS_DB_HOST=mariadb
ENV WORDPRESS_DB_USER=root
ENV WORDPRESS_DB_PASSWORD=root
ENV WORDPRESS_DB_NAME=wordpress

# Install MariaDB client for WordPress to connect
RUN apt-get update && apt-get install -y mariadb-client

# Copy and activate Smart Google Code Inserter plugin
COPY smart-google-code-inserter.zip /usr/src/wordpress/wp-content/plugins/
RUN unzip /usr/src/wordpress/wp-content/plugins/smart-google-code-inserter.zip -d /usr/src/wordpress/wp-content/plugins/
RUN chown -R www-data:www-data /usr/src/wordpress/wp-content/plugins/smart-google-code-inserter

# Expose port 80 for HTTP
EXPOSE 80

# Start WordPress and MariaDB services
CMD ["docker-entrypoint.sh", "apache2-foreground"]