# Use an official WordPress image
FROM wordpress:latest

# Set the WP-UserOnline plugin version
ENV WP_USERONLINE_VERSION 2.88.0

# Download and install WP-UserOnline plugin
RUN curl -o /usr/src/wordpress/wp-content/plugins/wp-useronline.zip -SL https://downloads.wordpress.org/plugin/wp-useronline.${WP_USERONLINE_VERSION}.zip \
    && unzip -q /usr/src/wordpress/wp-content/plugins/wp-useronline.zip -d /usr/src/wordpress/wp-content/plugins/ \
    && rm /usr/src/wordpress/wp-content/plugins/wp-useronline.zip

# Set up MariaDB environment variables
ENV MYSQL_ROOT_PASSWORD=root_password
ENV MYSQL_DATABASE=wordpress
ENV MYSQL_USER=wordpress_user
ENV MYSQL_PASSWORD=wordpress_password

# Use an official MariaDB image with a specific version
FROM mariadb:latest

# Copy custom MariaDB configuration file
COPY my.cnf /etc/mysql/conf.d/my.cnf

# Copy the initialization script to create the database and user
COPY init.sql /docker-entrypoint-initdb.d/init.sql
