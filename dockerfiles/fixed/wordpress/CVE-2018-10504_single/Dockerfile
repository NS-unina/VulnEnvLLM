# Use an official WordPress image
FROM wordpress:latest

# Set environment variables for MariaDB
ENV MYSQL_ROOT_PASSWORD=YOUR_DB_PASSWORD
ENV MYSQL_DATABASE=wordpress
ENV MYSQL_USER=wordpress
ENV MYSQL_PASSWORD=YOUR_WP_DB_PASSWORD

# Install necessary PHP extensions for Form Maker
RUN docker-php-ext-install mysqli pdo pdo_mysql
RUN apt update && apt install -y unzip

# Install Form Maker plugin
RUN curl -o /tmp/form-maker.zip -SL https://downloads.wordpress.org/plugin/form-maker.1.12.20.zip \
    && unzip /tmp/form-maker.zip -d /usr/src/wordpress/wp-content/plugins/ \
    && rm /tmp/form-maker.zip

# Expose the default WordPress and MariaDB ports
EXPOSE 80

# Copy the entrypoint script to set up database and start services
COPY ./docker-entrypoint.sh /usr/local/bin/

# Make the entrypoint script executable
RUN chmod +x /usr/local/bin/docker-entrypoint.sh

# Set the entrypoint script
ENTRYPOINT ["docker-entrypoint.sh"]

# Start the services
CMD ["apache2-foreground"]