# Use Ubuntu 18.04 as the base image
FROM ubuntu:18.04

# Install necessary dependencies
RUN apt-get update && apt-get install -y \
    wget \
    build-essential \
    ca-certificates \
    libreadline-dev \
    zlib1g-dev \
    libssl-dev \
    libxml2-dev \
    libxml2-utils \
    libxml2-dev \
    libxslt-dev \
    libperl-dev \
    python3 \
    python3-pip \
    llvm \
    libxml2-dev \
    libssl-dev \
    zlib1g-dev \
    libpam0g-dev \
    libedit-dev \
    libbsd-dev \
    build-essential \
    bison \
    flex \
    git \
    cmake \
    ninja-build \
    libtool \
    pkg-config \
    sudo \
    vim \
    curl \
    lsb-release \
    gnupg \
    postgresql-client

# Install Node.js 9.0.0
RUN curl -sL https://deb.nodesource.com/setup_9.x | bash -
RUN apt-get install -y nodejs

# Download PostgreSQL source
RUN wget https://ftp.postgresql.org/pub/source/v13.2/postgresql-13.2.tar.gz

# Unpack the source code
RUN tar xfz postgresql-13.2.tar.gz

# Change directory to the postgresql source
WORKDIR /postgresql-13.2

# Configure, make, and install PostgreSQL
RUN ./configure && make && make install

# Add PostgreSQL bin directory to PATH
ENV PATH="/usr/local/pgsql/bin:${PATH}"

# Expose PostgreSQL default port
EXPOSE 5432

# Set the default command to run when starting the container
CMD ["postgres"]