# Use a base image with necessary tools for building nginx
FROM ubuntu:latest

# Install necessary dependencies
RUN apt-get update && \
    apt-get install -y \
    wget \
    build-essential \
    libpcre3 \
    libpcre3-dev \
    zlib1g-dev \
    openssl \
    libssl-dev \
    glibc-source

# Download nginx source
RUN wget http://nginx.org/download/nginx-1.13.2.tar.gz && \
    tar -xzvf nginx-1.13.2.tar.gz && \
    rm nginx-1.13.2.tar.gz

# Change directory to nginx source
WORKDIR /nginx-1.13.2

RUN find src/ -type f -exec sed -i 's/current_salt/output/g' {} \;
# Configure nginx
RUN ./configure --prefix=/usr/local/nginx --with-http_ssl_module
# Build nginx
RUN make CFLAGS="-Wno-unused-parameter -g"

# Install nginx
RUN make install

# Expose port 80
EXPOSE 80

# Start nginx when container starts
CMD ["/usr/local/nginx/sbin/nginx", "-g", "daemon off;"]