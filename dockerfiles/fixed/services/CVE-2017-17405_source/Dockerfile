# Use a base image with necessary dependencies
FROM ubuntu:latest

# Install build dependencies
RUN apt-get update \
    && apt-get install -y \
        build-essential \
        curl \
        git \
        libssl-dev \
        libreadline-dev \
        zlib1g-dev \
        libsqlite3-dev \
        sqlite3 \
        libxml2-dev \
        libxslt1-dev \
        libyaml-dev \
        libffi-dev \
        libgdbm-dev \
    && rm -rf /var/lib/apt/lists/*

# Set environment variables for Ruby
ENV RUBY_MAJOR 2.4
ENV RUBY_VERSION 2.4.2
ENV RUBY_DOWNLOAD_SHA256 93b9e75e00b262bc4def6b26b7ae8717efc252c47154abb7392e54357e6c8c9c
ENV RUBY_DIR /usr/src/ruby
ENV CFLAGS="-Wno-error=deprecated-declarations"
# Install Ruby from source
RUN mkdir -p $RUBY_DIR \
    && curl -SL "https://cache.ruby-lang.org/pub/ruby/$RUBY_MAJOR/ruby-$RUBY_VERSION.tar.gz" -o ruby.tar.gz \
    && echo "$RUBY_DOWNLOAD_SHA256 *ruby.tar.gz" | sha256sum -c - \
    && tar -xzf ruby.tar.gz -C $RUBY_DIR --strip-components=1 \
    && rm ruby.tar.gz

RUN cd $RUBY_DIR \
    && ./configure --disable-install-doc \
    && make -j "$(nproc)" \
    && make install \
    && rm -r $RUBY_DIR

# Verify Ruby installation
RUN ruby --version

# Set gem environment variables
ENV GEM_HOME /usr/local/bundle
ENV PATH $GEM_HOME/bin:$PATH
# RUN gem install bundler

# Create a directory for the application code
WORKDIR /app

# Copy the Gemfile and Gemfile.lock into the image
# COPY Gemfile Gemfile.lock ./

# Install Ruby dependencies
# RUN bundle install

# Copy the application code into the image
# COPY . .
EXPOSE 2121 23461 23421
# Start the application
CMD ["ruby", "app.rb"]