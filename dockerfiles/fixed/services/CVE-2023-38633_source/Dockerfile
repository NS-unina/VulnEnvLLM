# Use a base image with necessary development tools and libraries
FROM ubuntu:latest
ENV PATH "${PATH}:/usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0"

# Install necessary packages for building librsvg and running the C program
RUN apt-get update && \
    apt-get install -y \
    build-essential \
    pkg-config \
    libglib2.0-dev \
    libcairo2-dev \
    libxml2-dev \
    git \
    wget \
    dh-autoreconf \
    gobject-introspection \
    libgirepository1.0-dev \
    cargo \
    libgdk-pixbuf2.0-dev \
    libharfbuzz-dev \
    libpango1.0-dev
    
# Clone librsvg from source
RUN git clone --branch 2.56.2 --depth 1 https://gitlab.gnome.org/GNOME/librsvg.git /librsvg

# Build and install librsvg
RUN cd /librsvg && \
    autoreconf -f -i && \
    ./autogen.sh && \
    make && \
    make install && \
    ldconfig

# Create a directory for your C program
RUN mkdir /app
WORKDIR /app

# Copy your C source code into the container
COPY main.c /app/

# Compile the C program
RUN gcc -o program main.c `pkg-config --cflags --libs librsvg-2.0`

# Set the entry point to your program
ENTRYPOINT ["./program"]