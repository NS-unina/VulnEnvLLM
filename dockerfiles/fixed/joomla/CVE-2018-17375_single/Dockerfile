# Use the official Joomla image as base
FROM joomla:latest

# Maintainer information
LABEL maintainer="Your Name <your.email@example.com>"

# Set environment variables
ENV JOOMLA_HOME /var/www/html

# Install required PHP extensions for Music Collection Component
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        unzip \
        && rm -rf /var/lib/apt/lists/*

# Download and install Music Collection Component
RUN curl -o /tmp/music_collection.zip -fSL https://downloads.sourceforge.net/project/musiccollection3/Music%20Collection%203/3.0.3/com_musiccollection_3.0.3_j3x.zip \
    && unzip /tmp/music_collection.zip -d /tmp/ \
    && mv /tmp/com_musiccollection /tmp/com_musiccollection_temp \
    && mv /tmp/com_musiccollection_temp/* $JOOMLA_HOME/components/ \
    && chown -R www-data:www-data $JOOMLA_HOME/components/com_musiccollection/ \
    && rm -rf /tmp/*

# Set up MySQL service
RUN apt-get update && \
    apt-get install -y mysql-server && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/* && \
    mkdir -p /var/run/mysqld && \
    chown -R mysql:mysql /var/run/mysqld && \
    chmod 777 /var/run/mysqld && \
    mkdir -p /var/lib/mysql && \
    chown -R mysql:mysql /var/lib/mysql

# Expose ports
EXPOSE 80 3306

# Copy custom configuration
# COPY config.php $JOOMLA_HOME/configuration.php

# Start MySQL service
CMD ["mysqld_safe"]