# Use the official WordPress image as base
FROM wordpress:latest

# Set up environment variables for MySQL
ENV WORDPRESS_DB_HOST=db \
    WORDPRESS_DB_USER=wordpress \
    WORDPRESS_DB_PASSWORD=password \
    WORDPRESS_DB_NAME=wordpress

# Install wget and unzip
RUN apt-get update && apt-get install -y wget unzip

# Download Smart Google Code Inserter plugin
RUN wget -O /tmp/smart-google-code-inserter.zip https://downloads.wordpress.org/plugin/smart-google-code-inserter.3.4.zip

# Install the plugin
RUN unzip /tmp/smart-google-code-inserter.zip -d /usr/src/wordpress/wp-content/plugins/ \
    && rm /tmp/smart-google-code-inserter.zip

# Set permissions
RUN chown -R www-data:www-data /usr/src/wordpress/wp-content/plugins/smart-google-code-inserter

# Expose port 80
EXPOSE 80

# Start the WordPress server
CMD ["apache2-foreground"]